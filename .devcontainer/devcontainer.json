{
    "name": "Python Dev Container",
    "image": "mcr.microsoft.com/devcontainers/python:3.11",
    "features": {
        "ghcr.io/devcontainers/features/docker-outside-of-docker:1": {
            "version": "latest"
        }
    },
    "postCreateCommand": "mkdir -p .devcontainer/temp && sudo apt-get update && sudo apt-get install -y --no-install-recommends default-mysql-client tigervnc-standalone-server tigervnc-common tigervnc-tools novnc websockify openbox x11-xserver-utils xauth net-tools python3-venv python3-dev build-essential fonts-liberation libxkbcommon-x11-0 libxcb-icccm4 libxcb-image0 libxcb-keysyms1 libxcb-randr0 libxcb-render-util0 libxcb-xinerama0 libxcb-xfixes0 qdbus-qt6 libqt6gui6 libqt6widgets6 libqt6core6 libqt6dbus6 && sudo apt-get clean && sudo rm -rf /var/lib/apt/lists/* && echo 'export PATH=\"/home/vscode/.local/bin:$PATH\"' >> ~/.bashrc && python3 -m pip install --upgrade pip wheel setuptools && python3 -m pip install -r requirements.txt && git config --global user.email \"oleg12203@gmail.com\" && git config --global user.name \"Oleg Kizyma\"",
    "customizations": {
        "vscode": {
            "settings": {
                "files.autoSave": "onFocusChange",
                "files.autoSaveDelay": 3000,
                "editor.formatOnSave": true,
                "[python]": {
                    "editor.defaultFormatter": "ms-python.python",
                    "editor.formatOnSave": true
                },
                "editor.codeActionsOnSave": {
                    "source.organizeImports": true,
                    "source.fixAll": true,
                    "source.fixAll.sortImports": true,
                    "source.fixAll.docformatter": true  // Добавлено для docformatter
                },
                "python.languageServer": "Pylance",
                "python.analysis.autoImportCompletions": true,
                "python.analysis.typeCheckingMode": "basic",
                "python.analysis.autoSearchPaths": true,
                "python.analysis.useLibraryCodeForTypes": true,
                "python.defaultInterpreterPath": "/usr/local/bin/python",
                "python.pip.downloadCache": "${containerWorkspaceFolder}/.pip-cache",
                "black-formatter.args": [
                    "--line-length",
                    "88",
                    "--target-version",
                    "py311"
                ],
                "python.linting.enabled": true,
                "python.linting.pylintEnabled": true,
                "python.linting.pylintArgs": [
                    "--disable=C0111",
                    "--disable=C0103",
                    "--max-line-length=88",
                    "--good-names=i,j,k,ex,Run,_",
                    "--ignore-patterns=test_.*?py",
                    "--load-plugins=pylint.extensions.docparams"
                ],
                "isort.args": [
                    "--profile",
                    "black",
                    "--multi-line",
                    "3",
                    "--include-trailing-comma",
                    "--force-grid-wrap",
                    "0",
                    "--use-parentheses",
                    "--line-after-imports",
                    "--line-before-comment"
                ],
                "isort.check": true,
                "autoDocstring.docstringFormat": "google",
                "autoDocstring.startOnNewLine": true,
                "docformatter.args": [
                    "--in-place",
                    "--blank",
                    "--wrap-summaries",
                    "120",
                    "--wrap-descriptions",
                    "120"
                ],
                "python.analysis.diagnosticMode": "workspace",
                "python.analysis.importFormat": "relative",
                "python.linting.flake8Enabled": true,
                "python.linting.flake8Args": [
                    "--max-line-length=88",
                    "--ignore=E203,W503"  // Игнорирование конфликтующих правил
                ],
                "mypy.enabled": true,
                "mypy.runUsingActiveInterpreter": true,
                "mypy.args": [
                    "--strict"  // Строгий режим проверки типов
                ]
            },
            "extensions": [
                "ms-python.python",
                "ms-python.vscode-pylance",
                "GitHub.copilot",
                "GitHub.copilot-chat",
                "ms-python.pylint",
                "ms-toolsai.jupyter",
                "mhutchie.git-graph",
                "eamodio.gitlens",
                "njpwerner.autodocstring",
                "ms-python.black-formatter",
                "ms-python.isort",
                "ms-python.flake8",
                "ms-python.mypy-type-checker",
                "ms-python.docformatter",
                "Continue.continue",
                "ms-kubernetes-tools.vscode-kubernetes-tools",
                "GitHub.vscode-pull-request-github"
            ]
        }
    },
    "remoteUser": "vscode",
    "mounts": [
        "source=/var/run/docker.sock,target=/var/run/docker.sock,type=bind"
    ],
    "forwardPorts": [
        5901,
        6080
    ],
    "postStartCommand": "mkdir -p ~/.vnc && echo 'password' | vncpasswd -f > ~/.vnc/passwd && chmod 600 ~/.vnc/passwd && mkdir -p /tmp/runtime-vscode && sudo chmod 700 /tmp/runtime-vscode && vncserver :1 -geometry 1920x1080 -depth 24 -localhost no && websockify -D --web=/usr/share/novnc/ 6080 localhost:5901 && sleep 2",
    "remoteEnv": {
        "DISPLAY": ":1",
        "XDG_RUNTIME_DIR": "/tmp/runtime-vscode",
        "PATH": "/home/vscode/.local/bin:/usr/local/bin:${containerEnv:PATH}",
        "PYTHONPATH": "${containerWorkspaceFolder}",
        "TEMP": "/tmp",
        "TMP": "/tmp"
    },
    "runArgs": [
        "--shm-size=1g",
        "--add-host=host.docker.internal:172.17.0.1"
    ]
}